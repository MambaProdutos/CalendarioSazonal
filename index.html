<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendário Estratégico de Vendas 2026</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --purple-900: #1e0d35;
      --purple-800: #2b1346;
      --purple-700: #432366;
      --purple-600: #5d3290;
      --purple-overlay: rgba(14, 5, 31, 0.75);
      --gold-500: #fdb927;
      --gold-300: #ffe18c;
      --text-main: #f5edff;
      --text-muted: #d9ceff;
      --danger: #f2707a;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at top, rgba(253, 185, 39, 0.1) 0%, transparent 55%),
        linear-gradient(180deg, var(--purple-900) 0%, var(--purple-600) 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    header {
      padding: 4.5rem 1.5rem 3rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    header::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 120%;
      height: 120%;
      background: radial-gradient(circle, rgba(253, 185, 39, 0.2), transparent 65%);
      z-index: -1;
    }

    header h1 {
      margin: 0;
      font-size: clamp(2.5rem, 5vw, 4.8rem);
      letter-spacing: 0.22rem;
      text-transform: uppercase;
    }

    header h1 span {
      color: var(--gold-500);
    }

    header p {
      max-width: 720px;
      margin: 1.4rem auto 0;
      color: var(--text-muted);
      font-size: 1.1rem;
      line-height: 1.7;
    }

    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1.5rem 4rem;
    }

    .calendar-shell {
      background: rgba(23, 10, 42, 0.75);
      border: 1px solid rgba(253, 185, 39, 0.25);
      border-radius: 24px;
      padding: 2.5rem;
      box-shadow: 0 35px 80px rgba(8, 3, 20, 0.6);
    }

    .calendar-shell h2 {
      margin: 0 0 1rem;
      text-transform: uppercase;
      letter-spacing: 0.18rem;
      color: var(--gold-300);
      font-size: 1.6rem;
    }

    .calendar-shell p.helper-text {
      margin: 0 0 2rem;
      color: var(--text-muted);
      line-height: 1.6;
    }

    .month-switcher {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.5rem;
      background: rgba(40, 16, 70, 0.85);
      border: 1px solid rgba(253, 185, 39, 0.25);
      border-radius: 18px;
      padding: 1rem 1.5rem;
      margin-bottom: 1.75rem;
    }

    .month-switcher button {
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(253, 185, 39, 0.15);
      color: var(--gold-500);
      border: 1px solid rgba(253, 185, 39, 0.4);
      padding: 0.85rem 1.25rem;
      border-radius: 999px;
      font-size: 0.95rem;
      font-weight: 700;
      letter-spacing: 0.05rem;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform 0.2s ease, background-color 0.2s ease, color 0.2s ease;
    }

    .month-switcher button span.icon {
      font-size: 1.5rem;
      line-height: 1;
    }

    .month-switcher button:hover,
    .month-switcher button:focus {
      background: rgba(253, 185, 39, 0.3);
      color: var(--text-main);
      transform: translateY(-2px);
    }

    .month-title {
      text-align: center;
    }

    .month-title small {
      display: block;
      color: var(--text-muted);
      letter-spacing: 0.18rem;
      text-transform: uppercase;
      font-size: 0.75rem;
      margin-bottom: 0.25rem;
    }

    .month-title strong {
      display: block;
      font-size: clamp(1.8rem, 3vw, 2.7rem);
      letter-spacing: 0.2rem;
      text-transform: uppercase;
    }

    .day-names {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 1.2rem;
      margin-bottom: 1rem;
      text-transform: uppercase;
      font-size: 0.85rem;
      letter-spacing: 0.12rem;
      color: var(--text-muted);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 1.2rem;
    }

    .day {
      appearance: none;
      -webkit-appearance: none;
      background: rgba(76, 48, 126, 0.28);
      border-radius: 18px;
      min-height: 130px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      border: 1px solid rgba(253, 185, 39, 0.18);
      position: relative;
      transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
      color: inherit;
      font: inherit;
      text-align: left;
      cursor: pointer;
      width: 100%;
    }

    .day:focus-visible {
      outline: 2px solid rgba(253, 185, 39, 0.7);
      outline-offset: 4px;
    }

    .day.placeholder {
      background: transparent;
      border-color: transparent;
      cursor: default;
    }

    .day.empty {
      border-style: dashed;
      border-color: rgba(253, 185, 39, 0.18);
      background: rgba(76, 48, 126, 0.18);
    }

    .day.empty:hover,
    .day.empty:focus-visible {
      transform: translateY(-3px);
      background: rgba(76, 48, 126, 0.32);
      box-shadow: 0 16px 32px rgba(8, 3, 20, 0.35);
    }

    .day-number {
      font-size: 1.6rem;
      font-weight: 700;
    }

    .day.is-event {
      background: linear-gradient(160deg, rgba(253, 185, 39, 0.92), rgba(255, 225, 140, 0.92));
      color: #231236;
      border: 1px solid rgba(253, 185, 39, 0.95);
      box-shadow: 0 12px 30px rgba(253, 185, 39, 0.35);
      cursor: pointer;
    }

    .day.is-event .day-number {
      color: #1c1030;
      transition: opacity 0.2s ease;
    }

    .day.is-event .event-labels {
      width: 100%;
      margin-top: 0.45rem;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .day.is-event .event-label {
      display: block;
      font-size: 0.82rem;
      font-weight: 700;
      letter-spacing: 0.05rem;
      text-align: left;
      text-transform: uppercase;
    }

    .event-label.custom {
      background: rgba(130, 82, 210, 0.22);
      border-radius: 8px;
      padding: 0.2rem 0.4rem;
      color: #1b0d3b;
    }

    .day.is-event:hover,
    .day.is-event:focus-visible {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(253, 185, 39, 0.55);
    }

    .day.is-custom {
      background: linear-gradient(160deg, rgba(130, 82, 210, 0.95), rgba(180, 136, 255, 0.92));
      border: 1px solid rgba(194, 158, 255, 0.8);
      box-shadow: 0 14px 36px rgba(120, 80, 210, 0.45);
      color: #fdfcff;
    }

    .day.is-custom .day-number {
      color: #fefbff;
    }

    .day.is-custom .event-label {
      color: #1b0d3b;
    }

    .day.is-custom:hover,
    .day.is-custom:focus-visible {
      transform: translateY(-4px);
      box-shadow: 0 22px 42px rgba(120, 80, 210, 0.65);
    }

    .day.has-custom {
      border-width: 2px;
      border-color: rgba(194, 158, 255, 0.9);
      box-shadow: 0 22px 42px rgba(94, 56, 168, 0.45);
    }

    @keyframes event-blink {
      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.25;
      }
    }

    .day.is-event:hover .day-number,
    .day.is-event:focus-visible .day-number,
    .day.is-custom:hover .day-number,
    .day.is-custom:focus-visible .day-number {
      animation: event-blink 0.9s linear infinite;
    }

    .legend {
      margin-top: 2rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .legend span {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .legend .dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      display: inline-block;
    }

    .legend .dot.custom {
      background: linear-gradient(160deg, rgba(130, 82, 210, 0.95), rgba(180, 136, 255, 0.95));
      box-shadow: 0 0 12px rgba(130, 82, 210, 0.55);
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(10, 2, 24, 0.82);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      z-index: 1000;
    }

    .modal-overlay.visible {
      display: flex;
    }

    .modal-content {
      position: relative;
      width: min(640px, 100%);
      max-height: 90vh;
      overflow-y: auto;
      background: rgba(33, 15, 60, 0.95);
      border: 1px solid rgba(253, 185, 39, 0.45);
      border-radius: 22px;
      padding: 2.5rem;
      box-shadow: 0 45px 90px rgba(5, 1, 14, 0.65);
      animation: pop 0.24s ease-out;
    }

    @keyframes pop {
      from {
        transform: scale(0.9);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(253, 185, 39, 0.15);
      border: 1px solid rgba(253, 185, 39, 0.4);
      color: var(--gold-500);
      border-radius: 999px;
      width: 40px;
      height: 40px;
      font-size: 1.5rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s ease;
    }

    .modal-close:hover,
    .modal-close:focus {
      background: rgba(253, 185, 39, 0.35);
      color: var(--text-main);
    }

    .modal-header h3 {
      margin: 0;
      font-size: 2rem;
      text-transform: uppercase;
      letter-spacing: 0.14rem;
      color: var(--gold-300);
    }

    .modal-header p {
      margin: 0.75rem 0 1.5rem;
      color: var(--text-muted);
    }

    .modal-section + .modal-section {
      margin-top: 1.75rem;
    }

    .modal-section h4 {
      margin: 0 0 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12rem;
      color: var(--gold-500);
      font-size: 0.95rem;
    }

    .modal-section p {
      margin: 0;
      line-height: 1.6;
    }

    .modal-event-title {
      margin: 1.75rem 0 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.12rem;
      color: var(--gold-300);
      font-size: 1.15rem;
    }

    .modal-event-date {
      margin: 0 0 1.5rem;
      color: var(--text-muted);
      font-size: 0.95rem;
    }

    .modal-divider {
      border: none;
      height: 1px;
      background: rgba(253, 185, 39, 0.25);
      margin: 2rem 0;
    }

    .chip-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
    }

    .chip {
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      background: rgba(253, 185, 39, 0.18);
      border: 1px solid rgba(253, 185, 39, 0.35);
      font-weight: 600;
      font-size: 0.8rem;
      letter-spacing: 0.05rem;
    }

    .timing-box {
      background: linear-gradient(135deg, rgba(253, 185, 39, 0.25), rgba(253, 185, 39, 0.05));
      border: 1px solid rgba(253, 185, 39, 0.35);
      border-radius: 18px;
      padding: 1.4rem;
    }

    .timing-box strong {
      display: block;
      font-size: 2.1rem;
      letter-spacing: 0.1rem;
      color: var(--gold-300);
      margin-top: 0.35rem;
    }

    .mini-calendars {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1.2rem;
      margin-top: 1rem;
    }

    .mini-month {
      background: rgba(19, 7, 38, 0.85);
      border: 1px solid rgba(253, 185, 39, 0.2);
      border-radius: 16px;
      padding: 1rem;
    }

    .mini-month h5 {
      margin: 0 0 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.1rem;
      font-size: 0.85rem;
      color: var(--gold-500);
    }

    .mini-grid {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 0.35rem;
      font-size: 0.7rem;
      text-align: center;
    }

    .mini-grid span {
      padding: 0.35rem 0.25rem;
      border-radius: 8px;
      background: rgba(82, 57, 129, 0.25);
      border: 1px solid transparent;
    }

    .mini-grid span.label {
      background: transparent;
      color: var(--text-muted);
      border: none;
      font-weight: 600;
      letter-spacing: 0.08rem;
    }

    .mini-grid span.empty {
      background: transparent;
      border: none;
    }

    .mini-grid span.planning {
      background: rgba(253, 185, 39, 0.18);
      border: 1px solid rgba(253, 185, 39, 0.35);
      color: var(--gold-300);
      font-weight: 700;
    }

    .mini-grid span.planning.custom {
      background: rgba(182, 140, 255, 0.22);
      border: 1px solid rgba(200, 165, 255, 0.45);
      color: #f5edff;
    }

    .mini-grid span.event-day {
      background: linear-gradient(160deg, rgba(253, 185, 39, 0.9), rgba(255, 225, 140, 0.9));
      border: 1px solid rgba(253, 185, 39, 0.95);
      color: #1d1032;
      font-weight: 800;
    }

    .mini-grid span.event-day.custom {
      background: linear-gradient(160deg, rgba(130, 82, 210, 0.95), rgba(180, 136, 255, 0.95));
      border: 1px solid rgba(180, 136, 255, 0.95);
      color: #1b0d3b;
    }

    .mini-legend {
      margin-top: 1rem;
      display: flex;
      gap: 1rem;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .mini-legend span {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .mini-legend .swatch {
      width: 14px;
      height: 14px;
      border-radius: 4px;
      display: inline-block;
    }

    .mini-legend .swatch.event-gold {
      background: linear-gradient(160deg, rgba(253, 185, 39, 0.9), rgba(255, 225, 140, 0.9));
      border: 1px solid rgba(253, 185, 39, 0.95);
    }

    .mini-legend .swatch.planning-gold {
      background: rgba(253, 185, 39, 0.18);
      border: 1px solid rgba(253, 185, 39, 0.35);
    }

    .mini-legend .swatch.event-custom {
      background: linear-gradient(160deg, rgba(130, 82, 210, 0.95), rgba(180, 136, 255, 0.95));
      border: 1px solid rgba(180, 136, 255, 0.95);
    }

    .mini-legend .swatch.planning-custom {
      background: rgba(182, 140, 255, 0.22);
      border: 1px solid rgba(200, 165, 255, 0.45);
    }

    .modal-event.custom .modal-event-title,
    .modal-header .badge-custom {
      color: rgba(200, 170, 255, 0.95);
    }

    .modal-event.custom .timing-box,
    .timing-box.custom {
      background: linear-gradient(135deg, rgba(182, 140, 255, 0.22), rgba(135, 91, 210, 0.22));
      border: 1px solid rgba(200, 165, 255, 0.4);
    }

    .modal-event.custom .chip,
    .custom-chip {
      background: rgba(182, 140, 255, 0.25);
      border: 1px solid rgba(200, 165, 255, 0.35);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.7rem;
      letter-spacing: 0.08rem;
      text-transform: uppercase;
      background: rgba(253, 185, 39, 0.18);
      border: 1px solid rgba(253, 185, 39, 0.35);
      border-radius: 999px;
      padding: 0.25rem 0.75rem;
      font-weight: 700;
    }

    .badge.badge-custom {
      background: rgba(182, 140, 255, 0.22);
      border-color: rgba(200, 165, 255, 0.45);
    }

    .modal-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }

    .modal-actions button {
      border-radius: 12px;
      padding: 0.75rem 1.25rem;
      font-weight: 700;
      font-size: 0.9rem;
      letter-spacing: 0.05rem;
      cursor: pointer;
      border: 1px solid transparent;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
    }

    .modal-actions .primary {
      background: linear-gradient(160deg, rgba(253, 185, 39, 0.9), rgba(255, 225, 140, 0.9));
      color: #1d1032;
      border-color: rgba(253, 185, 39, 0.95);
    }

    .modal-actions .secondary {
      background: rgba(82, 57, 129, 0.35);
      border-color: rgba(200, 165, 255, 0.35);
      color: var(--text-main);
    }

    .modal-actions .danger {
      background: rgba(242, 112, 122, 0.2);
      border-color: rgba(242, 112, 122, 0.55);
      color: #ffb8bf;
    }

    .modal-actions button:hover,
    .modal-actions button:focus-visible {
      transform: translateY(-2px);
      box-shadow: 0 16px 32px rgba(8, 3, 20, 0.35);
    }

    .custom-event-form {
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      margin-top: 1.5rem;
    }

    .custom-event-form .form-field {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .custom-event-form label {
      font-size: 0.85rem;
      letter-spacing: 0.08rem;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .custom-event-form input,
    .custom-event-form textarea {
      background: rgba(24, 10, 44, 0.75);
      border: 1px solid rgba(200, 165, 255, 0.25);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      color: var(--text-main);
      font-family: inherit;
      font-size: 0.95rem;
      resize: vertical;
      min-height: 48px;
    }

    .custom-event-form textarea {
      min-height: 120px;
    }

    .custom-event-form input:focus-visible,
    .custom-event-form textarea:focus-visible {
      outline: 2px solid rgba(200, 165, 255, 0.45);
      border-color: rgba(200, 165, 255, 0.45);
    }

    .custom-event-helper {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: -0.25rem;
    }

    .custom-event-helper.error {
      color: #ff9aa5;
      margin-top: 0;
    }

    @media (max-width: 768px) {
      .calendar-shell {
        padding: 1.75rem;
      }

      .day {
        min-height: 110px;
        padding: 0.75rem;
      }

      .month-switcher {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
      }

      .month-switcher button {
        justify-content: center;
      }

      .month-switcher button span.icon {
        font-size: 1.35rem;
      }

      .day-names,
      .calendar-grid {
        gap: 0.75rem;
      }

      .day.is-event::after {
        display: none;
      }
    }

    @media (max-width: 600px) {
      .calendar-shell {
        padding: 1.25rem 1rem 2rem;
      }

      .day {
        min-height: 95px;
        padding: 0.6rem;
      }

      .day-number {
        font-size: 1.35rem;
      }

      .day .event-label {
        font-size: 0.75rem;
      }

      .day-names,
      .calendar-grid {
        gap: 0.5rem;
      }
    }

    @media (max-width: 480px) {
      header {
        padding: 3.5rem 1rem 2.5rem;
      }

      header h1 {
        letter-spacing: 0.14rem;
      }

      header p {
        font-size: 0.95rem;
      }

      .calendar-shell {
        padding: 1rem 0.75rem 1.5rem;
      }

      .month-switcher {
        gap: 1rem;
      }

      .day-names {
        grid-template-columns: repeat(7, minmax(70px, 1fr));
        gap: 0.35rem;
        font-size: 0.75rem;
      }

      .calendar-grid {
        grid-template-columns: repeat(7, minmax(70px, 1fr));
        gap: 0.35rem;
        overflow-x: auto;
        padding-bottom: 0.5rem;
      }

      .day {
        min-height: 90px;
      }

      .day.empty {
        min-height: 85px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1><span>Marketplace</span> Strategy 2026</h1>
    <p>
      Calendário estratégico com todos os marcos sazonais do ano. Use as setas evidenciadas para navegar mês a mês e clique nas datas em dourado para ver as ações recomendadas, categorias prioritárias e o plano visual de preparação.
    </p>
  </header>

  <main>
    <section class="calendar-shell">
      <h2>Visão mensal interativa</h2>
      <p class="helper-text">Janeiro é exibido por padrão. As setas deixam claro que você pode avançar ou voltar o mês. Datas douradas são clicáveis e revelam o plano completo da campanha.</p>

      <div class="month-switcher">
        <button type="button" id="previous-month" aria-label="Mês anterior">
          <span class="icon">&#8592;</span>
          <span>Mês anterior</span>
        </button>
        <div class="month-title">
          <small>Planejamento 2026</small>
          <strong id="month-title">Janeiro</strong>
        </div>
        <button type="button" id="next-month" aria-label="Próximo mês">
          <span>Próximo mês</span>
          <span class="icon">&#8594;</span>
        </button>
      </div>

      <div class="day-names">
        <span>Dom</span>
        <span>Seg</span>
        <span>Ter</span>
        <span>Qua</span>
        <span>Qui</span>
        <span>Sex</span>
        <span>Sáb</span>
      </div>

      <div id="calendar-grid" class="calendar-grid" aria-live="polite"></div>

      <div class="legend" aria-hidden="true">
        <span><span class="dot" style="background: linear-gradient(160deg, rgba(253,185,39,0.92), rgba(255,225,140,0.92)); box-shadow: 0 0 12px rgba(253,185,39,0.55);"></span> Datas sazonais oficiais</span>
        <span><span class="dot custom"></span> Datas personalizadas (visão interna)</span>
        <span><span class="dot" style="background: rgba(76,48,126,0.45);"></span> Dias livres (clique para criar)</span>
      </div>
    </section>
  </main>

  <div class="modal-overlay" id="event-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal-content">
      <button type="button" class="modal-close" aria-label="Fechar" id="close-modal">&times;</button>
      <div id="modal-details"></div>
    </div>
  </div>

  <script>
    const YEAR = 2026;

    const seasonalEvents = [
      { id: 1, date: '01/01', month: 0, day: 1, event: 'Ano Novo / Spike Day', focus: 'Spike em 1º de Janeiro e pós-festas com liquidações agressivas.', timing: '19 dias', categories: ['Geral', 'Moda', 'Viagens', 'Casa'] },
      { id: 2, date: '15/01', month: 0, day: 15, event: 'Volta às Aulas (Pico 1)', focus: 'Material escolar, eletrônicos para estudo e moda infantil para o retorno às aulas.', timing: '39 dias', categories: ['Material Escolar', 'Eletrônicos', 'Moda Infantil', 'Mobiliário'] },
      { id: 3, date: '02/02', month: 1, day: 2, event: 'Spike Day Fevereiro', focus: 'Promoção tática no início de fevereiro focada em conversão imediata.', timing: '19 dias', categories: ['Geral', 'Beleza', 'Eletrônicos'] },
      { id: 4, date: '14/02', month: 1, day: 14, event: 'Valentine\'s Day', focus: 'Moda íntima, presentes românticos, gastronomia e pacotes de viagem.', timing: '29 dias', categories: ['Moda e Acessórios', 'Viagens', 'Beleza', 'Jóias'] },
      { id: 5, date: '17/02', month: 1, day: 17, event: 'Carnaval', focus: 'Fantasias, viagens, maquiagem temática e bebidas.', timing: '29 dias', categories: ['Viagens', 'Festa e Fantasia', 'Maquiagem', 'Alimentos e Bebidas'] },
      { id: 26, date: '03/03', month: 2, day: 3, event: 'Spike Day Março', focus: 'Campanha relâmpago no começo de março para manter a tração pós-Carnaval.', timing: '19 dias', categories: ['Geral', 'Eletrônicos', 'Casa e Decoração'] },
      { id: 6, date: '08/03', month: 2, day: 8, event: 'Dia da Mulher', focus: 'Beleza, autocuidado, perfumes e presentes premium.', timing: '29 dias', categories: ['Beleza e Cosméticos', 'Auto-cuidado', 'Presentes', 'Moda'] },
      { id: 7, date: '15/03', month: 2, day: 15, event: 'Dia do Consumidor', focus: 'Maior evento promocional do 1º semestre com descontos agressivos.', timing: '29 dias', categories: ['Eletrônicos', 'Casa e Decoração', 'Geral'] },
      { id: 8, date: '01/04', month: 3, day: 1, event: 'Virada Outono/Inverno', focus: 'Lançamento de coleções, aquecimento e decoração aconchegante.', timing: '19 dias', categories: ['Moda Inverno', 'Casa e Decoração', 'Eletrodomésticos'] },
      { id: 9, date: '04/04', month: 3, day: 4, event: 'Páscoa', focus: 'Chocolates, confeitaria especial, brinquedos e artigos de mesa.', timing: '29 dias', categories: ['Alimentos e Bebidas', 'Brinquedos', 'Casa e Decoração'] },
      { id: 10, date: '04/04', month: 3, day: 4, event: 'Spike Day Abril', focus: 'Campanha relâmpago sincronizada com a Páscoa para conversão rápida.', timing: '19 dias', categories: ['Geral', 'Moda', 'Eletrônicos'] },
      { id: 27, date: '05/05', month: 4, day: 5, event: 'Spike Day Maio', focus: 'Ofertas rápidas para antecipar campanhas de Dia das Mães e renovar estoque leve.', timing: '19 dias', categories: ['Moda', 'Beleza', 'Eletrônicos', 'Presentes'] },
      { id: 11, date: '10/05', month: 4, day: 10, event: 'Dia das Mães', focus: 'Presentes afetivos, tecnologia, moda, beleza e experiências de viagem.', timing: '39 dias', categories: ['Moda', 'Beleza', 'Eletrônicos', 'Jóias', 'Flores'] },
      { id: 28, date: '06/06', month: 5, day: 6, event: 'Spike Day Junho', focus: 'Impulsionar combos de inverno e antecipar a comunicação do Dia dos Namorados.', timing: '19 dias', categories: ['Moda Inverno', 'Cama/Mesa/Banho', 'Beleza', 'Eletrônicos'] },
      { id: 12, date: '12/06', month: 5, day: 12, event: 'Dia dos Namorados', focus: 'Presentes para casais, moda inverno e enxoval.', timing: '29 dias', categories: ['Moda e Acessórios', 'Beleza', 'Cama/Mesa/Banho', 'Gastronomia'] },
      { id: 13, date: '21/06', month: 5, day: 21, event: 'Início do Inverno / Festas Juninas', focus: 'Moda inverno, itens de conforto e artigos de festa junina.', timing: '39 dias', categories: ['Moda Inverno', 'Alimentos', 'Casa e Decoração'] },
      { id: 14, date: '07/07', month: 6, day: 7, event: 'Spike Day Julho', focus: 'Promoção rápida aproveitando o meio das férias.', timing: '19 dias', categories: ['Geral', 'Brinquedos', 'Viagens'] },
      { id: 15, date: '15/07', month: 6, day: 15, event: 'Volta às Aulas (Pico 2)', focus: 'Lazer, viagem e brinquedos preparando a segunda onda escolar.', timing: '29 dias', categories: ['Brinquedos', 'Viagens', 'Lazer', 'Material Escolar'] },
      { id: 29, date: '08/08', month: 7, day: 8, event: 'Spike Day Agosto', focus: 'Ofertas relâmpago para o último aquecimento do Dia dos Pais.', timing: '19 dias', categories: ['Eletrônicos', 'Ferramentas', 'Moda Masculina', 'Perfumes'] },
      { id: 16, date: '09/08', month: 7, day: 9, event: 'Dia dos Pais', focus: 'Eletrônicos, ferramentas, perfumes e hobbies masculinos.', timing: '29 dias', categories: ['Eletrônicos', 'Ferramentas', 'Perfumes', 'Moda Masculina'] },
      { id: 17, date: '09/09', month: 8, day: 9, event: 'Spike Day Setembro / Pré-Black Friday', focus: 'Aquecer audiência, testar logística e preparar estoque.', timing: '90 dias', categories: ['Geral', 'Logística', 'Estoque'] },
      { id: 18, date: '22/09', month: 8, day: 22, event: 'Início da Primavera', focus: 'Coleções primavera/verão e artigos de jardinagem.', timing: '29 dias', categories: ['Moda e Acessórios', 'Beleza', 'Jardinagem'] },
      { id: 19, date: '28/09', month: 8, day: 28, event: 'MELIXP', focus: 'Evento Mercado Livre com foco em Black Friday, logística e estoque.', timing: '90 dias', categories: ['Geral', 'Logística', 'Estoque', 'E-commerce'] },
      { id: 30, date: '10/10', month: 9, day: 10, event: 'Spike Day Outubro', focus: 'Aquecimento para Dia das Crianças e Halloween com testes de criativos.', timing: '19 dias', categories: ['Brinquedos', 'Games', 'Fantasia', 'Moda Infantil'] },
      { id: 20, date: '12/10', month: 9, day: 12, event: 'Dia das Crianças', focus: 'Brinquedos, games, fantasias e eletrônicos infantis.', timing: '39 dias', categories: ['Brinquedos', 'Games', 'Fantasia', 'Moda Infantil'] },
      { id: 21, date: '15/10', month: 9, day: 15, event: 'Dia dos Professores', focus: 'Presentes de baixo e médio ticket para educadores.', timing: '19 dias', categories: ['Presentes', 'Livros', 'Papelaria'] },
      { id: 22, date: '31/10', month: 9, day: 31, event: 'Halloween', focus: 'Fantasias temáticas, decoração e maquiagem especial.', timing: '19 dias', categories: ['Fantasia', 'Decoração', 'Maquiagem'] },
      { id: 31, date: '11/11', month: 10, day: 11, event: 'Spike Day Novembro', focus: 'Esquenta oficial da Black Friday para treinar ofertas e algoritmos.', timing: '19 dias', categories: ['Eletrônicos', 'Casa', 'Moda', 'Beleza'] },
      { id: 23, date: '27/11', month: 10, day: 27, event: 'Black Friday (Pico Máximo)', focus: 'Grande liquidação multicanal com foco em tecnologia e grandes ofertas.', timing: '90 dias', categories: ['Todas', 'Eletrônicos', 'Moda', 'Casa', 'Beleza'] },
      { id: 24, date: '30/11', month: 10, day: 30, event: 'Cyber Monday', focus: 'Queima de estoque pós-Black Friday com ênfase em produtos online.', timing: '90 dias', categories: ['Eletrônicos', 'Informática', 'Acessórios'] },
      { id: 32, date: '12/12', month: 11, day: 12, event: 'Spike Day Dezembro', focus: 'Impulsionar conversões finais antes do Natal com destaque para entregas rápidas.', timing: '19 dias', categories: ['Presentes', 'Eletrônicos', 'Moda', 'Casa', 'Alimentos'] },
      { id: 25, date: '25/12', month: 11, day: 25, event: 'Natal', focus: 'Presentes, decoração e preparação de fim de ano.', timing: '90 dias', categories: ['Brinquedos', 'Eletrônicos', 'Moda', 'Casa', 'Alimentos'] }
    ];

    const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];

    const baseEventsByKey = new Map();
    seasonalEvents.forEach(evt => {
      const key = `${evt.month}-${evt.day}`;
      if (!baseEventsByKey.has(key)) {
        baseEventsByKey.set(key, []);
      }
      baseEventsByKey.get(key).push(evt);
    });
    baseEventsByKey.forEach(list => {
      list.sort((a, b) => a.id - b.id);
    });

    const CUSTOM_EVENTS_STORAGE_KEY = 'marketplace-strategy-custom-events-v1';
    let customEventsByKey = loadCustomEvents();

    let currentMonth = 0;

    const monthTitleEl = document.getElementById('month-title');
    const calendarGridEl = document.getElementById('calendar-grid');
    const modalOverlay = document.getElementById('event-modal');
    const modalDetails = document.getElementById('modal-details');
    const closeModalBtn = document.getElementById('close-modal');

    function formatDate(day, month) {
      return `${String(day).padStart(2, '0')}/${String(month + 1).padStart(2, '0')}`;
    }

    function escapeHtml(value) {
      if (value === null || value === undefined) {
        return '';
      }
      return String(value).replace(/[&<>"']/g, match => {
        const replacements = {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;',
        };
        return replacements[match] || match;
      });
    }

    function extractNumberFromTiming(value) {
      if (value === null || value === undefined) {
        return 0;
      }
      const match = String(value).match(/(\d+)/);
      return match ? parseInt(match[1], 10) : 0;
    }

    function getPreparationDays(event) {
      if (event && typeof event.preparationDays === 'number' && !Number.isNaN(event.preparationDays)) {
        return event.preparationDays;
      }
      return extractNumberFromTiming(event?.timing);
    }

    function loadCustomEvents() {
      const map = new Map();
      if (typeof window === 'undefined') {
        return map;
      }
      try {
        const raw = window.localStorage.getItem(CUSTOM_EVENTS_STORAGE_KEY);
        if (!raw) {
          return map;
        }
        const parsed = JSON.parse(raw);
        Object.keys(parsed).forEach(key => {
          const stored = parsed[key];
          if (!stored) {
            return;
          }
          const month = Number(stored.month);
          const day = Number(stored.day);
          if (Number.isNaN(month) || Number.isNaN(day)) {
            return;
          }
          const preparationDays = getPreparationDays(stored);
          const categories = Array.isArray(stored.categories)
            ? stored.categories
            : String(stored.categories || '')
                .split(/[,\n]/)
                .map(category => category.trim())
                .filter(Boolean);
          const event = {
            id: stored.id || `custom-${month}-${day}`,
            month,
            day,
            date: stored.date || formatDate(day, month),
            event: stored.event || 'Data personalizada',
            focus: stored.focus || '',
            timing: preparationDays === 1 ? '1 dia' : `${preparationDays} dias`,
            categories,
            preparationDays,
            isCustom: true,
          };
          map.set(key, [event]);
        });
      } catch (error) {
        console.warn('Não foi possível carregar os eventos personalizados.', error);
      }
      return map;
    }

    function persistCustomEvents() {
      if (typeof window === 'undefined') {
        return;
      }
      const serialized = {};
      customEventsByKey.forEach((events, key) => {
        if (!events || !events.length) {
          return;
        }
        const event = events[0];
        serialized[key] = { ...event };
      });
      try {
        window.localStorage.setItem(CUSTOM_EVENTS_STORAGE_KEY, JSON.stringify(serialized));
      } catch (error) {
        console.warn('Não foi possível salvar os eventos personalizados.', error);
      }
    }

    function getCombinedEvents(month, day) {
      const key = `${month}-${day}`;
      const official = baseEventsByKey.get(key) || [];
      const custom = customEventsByKey.get(key) || [];
      const combined = [...official, ...custom];
      if (combined.length > 1) {
        combined.sort((a, b) => {
          if (!!a.isCustom === !!b.isCustom) {
            if (a.id === b.id) {
              return 0;
            }
            return a.id > b.id ? 1 : -1;
          }
          return a.isCustom ? 1 : -1;
        });
      }
      return combined;
    }

    function getCustomEvent(month, day) {
      const key = `${month}-${day}`;
      const stored = customEventsByKey.get(key);
      return stored ? stored[0] : null;
    }

    function updateMonthTitle() {
      monthTitleEl.textContent = monthNames[currentMonth];
    }

    function renderCalendar() {
      updateMonthTitle();
      calendarGridEl.innerHTML = '';

      const firstDayOfMonth = new Date(YEAR, currentMonth, 1).getDay();
      const totalDays = new Date(YEAR, currentMonth + 1, 0).getDate();

      for (let i = 0; i < firstDayOfMonth; i++) {
        const placeholder = document.createElement('div');
        placeholder.className = 'day placeholder';
        calendarGridEl.appendChild(placeholder);
      }

      for (let day = 1; day <= totalDays; day++) {
        const events = getCombinedEvents(currentMonth, day);
        const hasEvents = events.length > 0;
        const hasOfficial = events.some(evt => !evt.isCustom);
        const hasCustom = events.some(evt => evt.isCustom);

        const dayEl = document.createElement('button');
        dayEl.type = 'button';
        dayEl.className = 'day';
        dayEl.dataset.month = currentMonth;
        dayEl.dataset.day = day;

        const dayNumber = document.createElement('span');
        dayNumber.className = 'day-number';
        dayNumber.textContent = day;
        dayEl.appendChild(dayNumber);

        if (!hasEvents) {
          dayEl.classList.add('empty');
          dayEl.setAttribute('aria-label', `Adicionar data sazonal em ${day} de ${monthNames[currentMonth]}`);
        } else {
          if (hasOfficial) {
            dayEl.classList.add('is-event');
          }
          if (hasCustom && !hasOfficial) {
            dayEl.classList.add('is-custom');
          }
          if (hasCustom && hasOfficial) {
            dayEl.classList.add('has-custom');
          }

          const labelsWrapper = document.createElement('div');
          labelsWrapper.className = 'event-labels';

          events.forEach(event => {
            const label = document.createElement('span');
            label.className = 'event-label';
            if (event.isCustom) {
              label.classList.add('custom');
            }
            label.textContent = event.event;
            labelsWrapper.appendChild(label);
          });

          dayEl.appendChild(labelsWrapper);

          const ariaLabel = events.length === 1
            ? `${events[0].event} em ${day} de ${monthNames[currentMonth]}`
            : `Eventos em ${day} de ${monthNames[currentMonth]}: ${events.map(event => event.event).join(', ')}`;
          dayEl.setAttribute('aria-label', ariaLabel);
        }

        dayEl.addEventListener('click', () => {
          if (hasEvents) {
            openEventModal(events, { month: currentMonth, day });
          } else {
            openCustomEventForm({ month: currentMonth, day });
          }
        });

        calendarGridEl.appendChild(dayEl);
      }
    }

    function buildMiniCalendars(event) {
      const daysToPrepare = getPreparationDays(event);
      const eventDate = new Date(YEAR, event.month, event.day);
      const startDate = new Date(eventDate);
      startDate.setDate(eventDate.getDate() - daysToPrepare + 1);

      const months = [];
      let cursorYear = startDate.getFullYear();
      let cursorMonth = startDate.getMonth();
      const endYear = eventDate.getFullYear();
      const endMonth = eventDate.getMonth();

      while (cursorYear < endYear || (cursorYear === endYear && cursorMonth <= endMonth)) {
        months.push({ year: cursorYear, month: cursorMonth });
        cursorMonth += 1;
        if (cursorMonth > 11) {
          cursorMonth = 0;
          cursorYear += 1;
        }
      }

      const planningStart = startDate.getTime();
      const planningEnd = eventDate.getTime();

      return months.map(({ year, month }) => {
        const monthName = monthNames[month] || new Date(year, month, 1).toLocaleDateString('pt-BR', { month: 'long' });
        const totalDays = new Date(year, month + 1, 0).getDate();
        const firstWeekDay = new Date(year, month, 1).getDay();

        const cells = [];
        const weekLabels = ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'];
        for (const label of weekLabels) {
          cells.push(`<span class="label">${label}</span>`);
        }

        for (let i = 0; i < firstWeekDay; i++) {
          cells.push('<span class="empty"></span>');
        }

        for (let day = 1; day <= totalDays; day++) {
          const dateInstance = new Date(year, month, day);
          const time = dateInstance.getTime();
          const classes = [];
          if (time >= planningStart && time <= planningEnd) {
            classes.push('planning');
            if (event.isCustom) {
              classes.push('custom');
            }
          }
          if (time === planningEnd) {
            classes.push('event-day');
            if (event.isCustom) {
              classes.push('custom');
            }
          }
          cells.push(`<span class="${classes.join(' ')}">${day}</span>`);
        }

        return `
          <div class="mini-month">
            <h5>${monthName} ${year}</h5>
            <div class="mini-grid">${cells.join('')}</div>
          </div>
        `;
      }).join('');
    }

    function buildLegendMarkup(event) {
      const planningClass = event.isCustom ? 'swatch planning-custom' : 'swatch planning-gold';
      const eventClass = event.isCustom ? 'swatch event-custom' : 'swatch event-gold';
      return `
        <div class="mini-legend">
          <span><span class="${planningClass}"></span> Dias de preparação</span>
          <span><span class="${eventClass}"></span> Data do evento</span>
        </div>
      `;
    }

    function openEventModal(events, context = {}) {
      const eventList = Array.isArray(events) ? [...events] : [events];
      if (!eventList.length) {
        openCustomEventForm(context);
        return;
      }

      const defaultMonth = eventList[0]?.month ?? currentMonth;
      const defaultDay = eventList[0]?.day ?? 1;
      const month = context.month ?? defaultMonth;
      const day = context.day ?? defaultDay;
      const formattedDate = formatDate(day, month);

      eventList.sort((a, b) => {
        if (!!a.isCustom === !!b.isCustom) {
          if (a.id === b.id) {
            return 0;
          }
          return a.id > b.id ? 1 : -1;
        }
        return a.isCustom ? 1 : -1;
      });

      const hasCustom = eventList.some(evt => evt.isCustom);
      let modalHtml = '';

      if (eventList.length === 1) {
        const event = eventList[0];
        const miniCalendars = buildMiniCalendars(event);
        const legend = buildLegendMarkup(event);
        const chips = event.categories.map(category => `<span class="${event.isCustom ? 'chip custom-chip' : 'chip'}">${escapeHtml(category)}</span>`).join('');
        const badge = event.isCustom ? '<span class="badge badge-custom">Interna</span>' : '<span class="badge">Oficial</span>';

        modalHtml = `
          <div class="modal-header">
            <h3 id="modal-title">${escapeHtml(event.event)} ${badge}</h3>
            <p>${formatDate(event.day, event.month)} de ${monthNames[event.month]} &bull; ${escapeHtml(event.timing)} de preparação recomendada</p>
          </div>

          <div class="modal-section timing-box${event.isCustom ? ' custom' : ''}">
            <h4>Início sugerido</h4>
            <p>Para chegar com força na data principal, reserve ${escapeHtml(event.timing)} de antecedência para estoque, campanhas e operação.</p>
            <strong>${escapeHtml(event.timing)}</strong>
          </div>

          <div class="modal-section">
            <h4>Foco estratégico</h4>
            <p>${escapeHtml(event.focus)}</p>
          </div>

          <div class="modal-section">
            <h4>Categorias em alta</h4>
            <div class="chip-list">
              ${chips}
            </div>
          </div>

          <div class="modal-section">
            <h4>Calendário de preparação</h4>
            <p>Os dias destacados indicam o período dedicado à preparação desta campanha.</p>
            <div class="mini-calendars">${miniCalendars}</div>
            ${legend}
          </div>
        `;

        if (event.isCustom) {
          modalHtml += `
            <div class="modal-actions">
              <button type="button" class="secondary" data-action="edit-custom" data-month="${event.month}" data-day="${event.day}">Editar data personalizada</button>
              <button type="button" class="danger" data-action="remove-custom" data-month="${event.month}" data-day="${event.day}">Remover data</button>
            </div>
          `;
        } else if (!hasCustom) {
          modalHtml += `
            <div class="modal-actions">
              <button type="button" class="secondary" data-action="create-custom" data-month="${month}" data-day="${day}">Criar data personalizada para este dia</button>
            </div>
          `;
        }
      } else {
        const eventBlocks = eventList.map(event => {
          const miniCalendars = buildMiniCalendars(event);
          const legend = buildLegendMarkup(event);
          const chips = event.categories.map(category => `<span class="${event.isCustom ? 'chip custom-chip' : 'chip'}">${escapeHtml(category)}</span>`).join('');
          const badge = event.isCustom ? '<span class="badge badge-custom">Interna</span>' : '<span class="badge">Oficial</span>';
          const actions = event.isCustom
            ? `
              <div class="modal-actions">
                <button type="button" class="secondary" data-action="edit-custom" data-month="${event.month}" data-day="${event.day}">Editar data personalizada</button>
                <button type="button" class="danger" data-action="remove-custom" data-month="${event.month}" data-day="${event.day}">Remover data</button>
              </div>
            `
            : '';

          return `
            <article class="modal-event${event.isCustom ? ' custom' : ''}">
              <h4 class="modal-event-title">${escapeHtml(event.event)} ${badge}</h4>
              <p class="modal-event-date">${formatDate(event.day, event.month)} de ${monthNames[event.month]} &bull; ${escapeHtml(event.timing)} de preparação recomendada</p>

              <div class="modal-section timing-box${event.isCustom ? ' custom' : ''}">
                <h4>Início sugerido</h4>
                <p>Para chegar com força na data principal, reserve ${escapeHtml(event.timing)} de antecedência para estoque, campanhas e operação.</p>
                <strong>${escapeHtml(event.timing)}</strong>
              </div>

              <div class="modal-section">
                <h4>Foco estratégico</h4>
                <p>${escapeHtml(event.focus)}</p>
              </div>

              <div class="modal-section">
                <h4>Categorias em alta</h4>
                <div class="chip-list">
                  ${chips}
                </div>
              </div>

              <div class="modal-section">
                <h4>Calendário de preparação</h4>
                <p>Os dias destacados indicam o período dedicado à preparação desta campanha.</p>
                <div class="mini-calendars">${miniCalendars}</div>
                ${legend}
              </div>
              ${actions}
            </article>
          `;
        }).join('<hr class="modal-divider">');

        modalHtml = `
          <div class="modal-header">
            <h3 id="modal-title">Campanhas desta data</h3>
            <p>${eventList.length} campanhas planejadas para ${formattedDate} de ${monthNames[month]}</p>
          </div>
          ${eventBlocks}
        `;

        if (!hasCustom) {
          modalHtml += `
            <div class="modal-actions">
              <button type="button" class="secondary" data-action="create-custom" data-month="${month}" data-day="${day}">Adicionar data personalizada a este dia</button>
            </div>
          `;
        }
      }

      modalDetails.innerHTML = modalHtml;
      modalOverlay.classList.add('visible');

      modalDetails.querySelectorAll('[data-action="create-custom"]').forEach(button => {
        button.addEventListener('click', event => {
          const targetMonth = Number(event.currentTarget.getAttribute('data-month'));
          const targetDay = Number(event.currentTarget.getAttribute('data-day'));
          openCustomEventForm({ month: targetMonth, day: targetDay });
        });
      });

      modalDetails.querySelectorAll('[data-action="edit-custom"]').forEach(button => {
        button.addEventListener('click', event => {
          const targetMonth = Number(event.currentTarget.getAttribute('data-month'));
          const targetDay = Number(event.currentTarget.getAttribute('data-day'));
          const existingEvent = getCustomEvent(targetMonth, targetDay);
          openCustomEventForm({ month: targetMonth, day: targetDay, existingEvent });
        });
      });

      modalDetails.querySelectorAll('[data-action="remove-custom"]').forEach(button => {
        button.addEventListener('click', event => {
          const targetMonth = Number(event.currentTarget.getAttribute('data-month'));
          const targetDay = Number(event.currentTarget.getAttribute('data-day'));
          const key = `${targetMonth}-${targetDay}`;
          const confirmed = window.confirm('Tem certeza de que deseja remover esta data personalizada?');
          if (!confirmed) {
            return;
          }
          customEventsByKey.delete(key);
          persistCustomEvents();
          renderCalendar();
          closeModal();
        });
      });
    }

    function openCustomEventForm({ month, day, existingEvent = null }) {
      const formattedDate = formatDate(day, month);
      const title = existingEvent ? 'Editar data personalizada' : 'Criar data personalizada';
      const nameValue = existingEvent ? escapeHtml(existingEvent.event) : '';
      const focusValue = existingEvent ? escapeHtml(existingEvent.focus) : '';
      const categoriesValue = existingEvent ? escapeHtml(existingEvent.categories.join(', ')) : '';
      const preparationValue = existingEvent && typeof existingEvent.preparationDays === 'number' ? existingEvent.preparationDays : '';

      modalDetails.innerHTML = `
        <div class="modal-header">
          <h3 id="modal-title">${title}</h3>
          <p>${formattedDate} de ${monthNames[month]}</p>
        </div>
        <form id="custom-event-form" class="custom-event-form">
          <div class="form-field">
            <label for="custom-name">Nome da data</label>
            <input id="custom-name" name="name" type="text" required value="${nameValue}" autocomplete="off" placeholder="Ex.: Mega Liquidação Interna">
          </div>
          <div class="form-field">
            <label for="custom-preparation">Tempo de preparação (dias)</label>
            <input id="custom-preparation" name="preparationDays" type="number" min="1" max="180" required value="${preparationValue}" placeholder="Ex.: 21">
            <span class="custom-event-helper">Informe apenas o número de dias necessários antes da data principal.</span>
          </div>
          <div class="form-field">
            <label for="custom-focus">Foco estratégico</label>
            <textarea id="custom-focus" name="focus" required placeholder="Descreva as principais frentes comerciais e de marketing.">${focusValue}</textarea>
          </div>
          <div class="form-field">
            <label for="custom-categories">Categorias em alta</label>
            <textarea id="custom-categories" name="categories" required placeholder="Separe por vírgula ou linha: Moda, Beleza, Casa">${categoriesValue}</textarea>
            <span class="custom-event-helper">Separe por vírgula ou quebra de linha para gerar os chips automaticamente.</span>
          </div>
          <p class="custom-event-helper error" id="custom-event-error" role="alert" aria-live="assertive"></p>
          <div class="modal-actions">
            <button type="submit" class="primary">${existingEvent ? 'Salvar alterações' : 'Salvar data personalizada'}</button>
            <button type="button" class="secondary" data-action="cancel">Cancelar</button>
            ${existingEvent ? '<button type="button" class="danger" data-action="remove">Remover data</button>' : ''}
          </div>
        </form>
      `;

      modalOverlay.classList.add('visible');

      const form = document.getElementById('custom-event-form');
      const errorEl = document.getElementById('custom-event-error');

      const handleSave = event => {
        event.preventDefault();
        errorEl.textContent = '';

        const formData = new FormData(form);
        const name = String(formData.get('name') || '').trim();
        const preparationDays = Number(formData.get('preparationDays'));
        const focus = String(formData.get('focus') || '').trim();
        const categoriesInput = String(formData.get('categories') || '').trim();
        const categories = categoriesInput
          .split(/[,\n]/)
          .map(category => category.trim())
          .filter(Boolean);

        if (!name || !focus || !categories.length || !Number.isFinite(preparationDays) || preparationDays <= 0) {
          errorEl.textContent = 'Preencha todos os campos obrigatórios com valores válidos.';
          return;
        }

        const key = `${month}-${day}`;
        const normalizedPreparation = Math.round(preparationDays);
        const customEvent = {
          id: existingEvent?.id || `custom-${month}-${day}`,
          month,
          day,
          date: formatDate(day, month),
          event: name,
          focus,
          timing: normalizedPreparation === 1 ? '1 dia' : `${normalizedPreparation} dias`,
          categories,
          preparationDays: normalizedPreparation,
          isCustom: true,
        };

        customEventsByKey.set(key, [customEvent]);
        persistCustomEvents();
        renderCalendar();
        openEventModal([customEvent], { month, day });
      };

      form.addEventListener('submit', handleSave);

      const cancelBtn = form.querySelector('[data-action="cancel"]');
      cancelBtn.addEventListener('click', () => {
        if (existingEvent) {
          openEventModal([existingEvent], { month, day });
        } else {
          closeModal();
        }
      });

      if (existingEvent) {
        const removeBtn = form.querySelector('[data-action="remove"]');
        removeBtn.addEventListener('click', () => {
          const confirmed = window.confirm('Tem certeza de que deseja remover esta data personalizada?');
          if (!confirmed) {
            return;
          }
          const key = `${month}-${day}`;
          customEventsByKey.delete(key);
          persistCustomEvents();
          renderCalendar();
          closeModal();
        });
      }
    }

    function closeModal() {
      modalOverlay.classList.remove('visible');
      modalDetails.innerHTML = '';
    }

    document.getElementById('previous-month').addEventListener('click', () => {
      currentMonth = (currentMonth - 1 + 12) % 12;
      renderCalendar();
    });

    document.getElementById('next-month').addEventListener('click', () => {
      currentMonth = (currentMonth + 1) % 12;
      renderCalendar();
    });

    modalOverlay.addEventListener('click', event => {
      if (event.target === modalOverlay) {
        closeModal();
      }
    });

    closeModalBtn.addEventListener('click', closeModal);

    document.addEventListener('keydown', event => {
      if (event.key === 'Escape' && modalOverlay.classList.contains('visible')) {
        closeModal();
      }
    });

    renderCalendar();
  </script>
</body>
</html>
